# 彩色标题栏

**中文** | [English](README.md)

## 更推荐的插件

[JetBrains TitleBar](https://marketplace.visualstudio.com/items?itemName=KasukabeTsumugi.jetbrains-titlebar)

一个基于项目名称为 VS Code 标题栏添加彩色背景的扩展。

## 2026-02-07 更新 - 版本 1.5.0 发布！

支持**工作区名称 + Git 分支名称**来生成标题栏颜色！现在你可以为同一项目的不同分支设置不同的标题栏颜色，让你一眼就能区分它们。

## ✨ 功能特性

- 🎨 **基于项目的颜色**: 根据你的项目自动生成独特的颜色
- 🔄 **多种哈希源**: 可选择项目名称、完整路径或项目名称+日期
- 🌈 **可自定义调色板**: 为浅色和深色主题分别设置颜色方案
- 📁 **智能项目检测**: 可配置文件/文件夹指示器来识别项目
- 🌍 **多语言支持**: 完整的中英文界面
- ✨ **渐变叠加效果**: 添加美丽的渐变叠加来增强标题栏外观（需要 CSS 修改）

## 🔥 重大更新

**所有之前的命令已被移除，并替换为统一的控制面板！** 新的控制面板为管理所有扩展设置提供了更直观和用户友好的界面。[了解更多关于控制面板的信息](#控制面板)。

![控制面板2](https://raw.githubusercontent.com/baendlorel/colorful-titlebar/refs/heads/main/draft/control-panel.png)

## ⚠️ 重要提示

**渐变功能会修改 VS Code 的核心 CSS 文件**，这可能触发 VS Code 的完整性检查并显示"损坏"警告。这是预期行为，不会影响功能。扩展会在任何修改前自动创建备份。

## 开发

1. 克隆或下载此项目
2. 在项目目录中运行 `pnpm install`
3. 运行 `pnpm build` 编译扩展
4. 按 `F5` 在新的 VS Code 窗口中测试扩展

## 控制面板

扩展现在具有全面的控制面板，用统一的、用户友好的界面替换了所有之前的命令。

### 打开控制面板

- **命令**: `Ctrl+Shift+P` → "Colorful Titlebar: Open Control Panel"

### 控制面板功能

控制面板提供所有扩展设置的实时配置：

#### 🔧 基本设置

- **显示信息消息**: 开启/关闭信息弹窗
- **工作台 CSS 路径**: 指定 VS Code 工作台 CSS 文件的自定义路径（用于渐变功能）

#### 🌈 颜色配置

- **哈希源**: 选择颜色生成方式：
  - 项目名称：仅基于文件夹名称
  - 完整路径：基于完整项目路径
  - 项目名称+日期：基于项目名称和当前日期
- **颜色选择器**: 为当前项目手动选择自定义颜色

#### ✨ 渐变设置

- **渐变样式**: 从多种渐变叠加效果中选择：
  - 无：禁用渐变叠加
  - 亮色中心：带有亮色中心的线性渐变
  - 左侧亮色：从左侧的径向渐变
  - 弧形左侧：从左侧的替代径向渐变
- **渐变亮度**: 控制亮色区域的亮度/不透明度 (0-100%)
- **渐变暗度**: 控制暗色区域的暗度/不透明度 (0-100%)

#### 🔄 操作

- **刷新颜色**: 强制为当前项目重新生成颜色
- **应用设置**: 所有更改立即应用并提供视觉反馈

#### 🎨 项目指示器配置

- **项目指示器**: 配置用于识别项目的文件或文件夹列表
  - 支持多行编辑，每行一个指示器
  - 自定义滚动条：美观的滚动条组件，支持流畅的鼠标滚轮和拖拽操作
  - 动态滚动条高度：滚动条大小反映内容比例

#### 🌈 主题调色板管理

- **浅色/深色主题调色板**: 为浅色主题配置颜色方案
  - 支持拖拽重新排序颜色
  - 点击颜色块进行编辑
  - 动态添加和删除颜色
  - 支持跨调色板拖拽移动颜色

### 实时反馈

控制面板提供：

- **实时预览**: 更改立即应用
- **错误处理**: 对无效输入提供清晰的错误消息
- **成功通知**: 设置成功应用时的确认
- **主题适配**: 控制面板自动适配 VS Code 当前主题

## 🚀 使用方法

### 快速开始

1. 在 VS Code 中打开任何项目
2. 扩展自动检测项目并应用颜色
3. 使用 `Ctrl+Shift+P` → "Colorful Titlebar: Open Control Panel" 自定义设置
4. 享受你的彩色标题栏！

### 渐变样式

- **亮中心**: 带有亮中心效果的线性渐变

  ![Bright Center Effect](https://raw.githubusercontent.com/baendlorel/colorful-titlebar/refs/heads/main/draft/light-center.png)

- **亮左侧**: 从左侧产生亮效果的径向渐变

  ![Bright Left Effect](https://raw.githubusercontent.com/baendlorel/colorful-titlebar/refs/heads/main/draft/light-left.png)

- **左侧弧光**: 从左侧产生亮效果的径向渐变 2

  ![Arc Left Effect](https://raw.githubusercontent.com/baendlorel/colorful-titlebar/refs/heads/main/draft/arc-left.png)

- **配合配置项**: `colorful-titlebar.gradientBrightness`和`colorful-titlebar.gradientDarkness` 来控制明暗度

### 前置要求

扩展需要将 VS Code 的标题栏样式设置为"自定义"。如果未配置，扩展会提示你自动更改。

**对于渐变功能**: 扩展需要修改 VS Code 的核心 CSS 文件。它会自动检测你的 VS Code 安装路径，或允许你指定自定义路径。

扩展需要 VS Code 的标题栏样式设置为"custom"。如果未配置，扩展将提示你自动更改。

## ⚙️ 配置选项

打开 VS Code 设置并配置以下选项：

### `colorful-titlebar.enabled`

- **类型**: 布尔值
- **默认值**: `true`
- **描述**: 启用或禁用彩色标题栏效果

### `colorful-titlebar.hashSource`

- **类型**: 字符串
- **默认值**: `"projectName"`
- **选项**:
  - `"projectName"`: 仅从项目文件夹名称生成颜色
  - `"fullPath"`: 从完整项目路径生成颜色
  - `"projectNameDate"`: 从项目名称和当前日期生成颜色
- **描述**: 生成基于哈希的颜色的源

### `colorful-titlebar.lightThemeColors`

- **类型**: 字符串数组
- **默认值**: `["rgb(167, 139, 250)", "rgb(147, 197, 253)", ...]`
- **描述**: 浅色主题的调色板
- **支持格式**: `#RRGGBB`, `#RRGGBBAA`, `rgb()`, `rgba()`

### `colorful-titlebar.darkThemeColors`

- **类型**: 字符串数组
- **默认值**: `["rgb(68, 0, 116)", "rgb(0, 47, 85)", ...]`
- **描述**: 深色主题的调色板
- **支持格式**: `#RRGGBB`, `#RRGGBBAA`, `rgb()`, `rgba()`

### `colorful-titlebar.projectIndicators`

- **类型**: 字符串数组
- **默认值**: `[".git", "package.json", "pom.xml", ...]`
- **描述**: 如果 VS Code 打开的目录包含这些文件中的一个，那么它会被认为是一个**项目**，从而拥有彩色标题栏

### `colorful-titlebar.workbenchCssPath`

- **类型**: 字符串
- **默认值**: `""`
- **描述**: workbench.desktop.main.css 文件的自定义路径。

### `colorful-titlebar.gradientBrightness`

- **类型**: 数字
- **默认值**: `0.72`
- **范围**: `0.0` 到 `1.0`
- **描述**: 控制渐变叠加中亮区域的亮度/不透明度。数值越高，亮效果越明显。

### `colorful-titlebar.gradientDarkness`

- **类型**: 数字
- **默认值**: `0.26`
- **范围**: `0.0` 到 `1.0`
- **描述**: 控制渐变叠加中暗区域的暗度/不透明度。数值越高，阴影效果越明显。

### `colorful-titlebar.showInfoPop`

- **类型**: 布尔值
- **默认值**: `true`
- **描述**: 是否显示信息提示消息

## 🔧 工作原理

### 基础颜色应用

1. **项目检测**: 检查配置的指示器文件（如 `.git`, `package.json`）
2. **颜色生成**: 从选定的源（项目名称/路径/日期）创建哈希
3. **颜色选择**: 将哈希映射到你配置的调色板中的颜色
4. **主题感知**: 为浅色和深色主题使用不同的调色板
5. **标题栏更新**: 将颜色应用到 VS Code 的标题栏背景

### 渐变增强（高级功能）

1. **CSS 文件检测**: 定位 VS Code 的 `workbench.desktop.main.css` 文件
2. **自动备份**: 在任何修改前创建备份
3. **CSS 注入**: 使用唯一标记添加渐变叠加样式
4. **样式选择**: 从不同的渐变效果中选择（亮中心、亮左侧）
5. **轻松恢复**: 使用禁用命令移除渐变，从备份中恢复

## 📋 系统要求

- VS Code 1.74.0 或更高版本
- 标题栏样式必须设置为"custom"（扩展将帮助你配置此项）

## ⚠️ 注意事项

- 扩展会修改 VS Code 的工作区设置用于基础颜色功能
- **渐变功能会修改 VS Code 的核心 CSS 文件**，可能会触发完整性警告
- 不同项目将根据你的哈希源选择获得一致的颜色
- 颜色会自动适应你当前的主题（浅色/深色）
- 渐变叠加会自动备份，可以安全移除
- 使用渐变功能时 VS Code 可能显示"损坏"警告 - 这是预期行为且安全

## 📄 许可证

MIT License - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📝 更新日志

### 1.4.0

- **🔐 配置加密与安全性**
  - **统一配置存储**: 所有设置现已合并到单个加密字段 `akasha` 中
    - 加密算法是**chacha20**
    - 配置数据经过压缩，从 旧版明文的 1100 字符缩减至约 430 字符
  - **数据序列化**: 高效的仅值数组序列化系统，替代键值对方式
  - **配置净化**: 通过全面的净化器函数增强数据验证

- **🎨 界面/体验改进**
  - **模板系统增强**: 从 `${}` 迁移到 `{{}}` 模板语法，配备完整的模板编译器
  - **类型安全**: 通过 `expect` 函数改进 TypeScript 集成和类型断言
  - **主题一致性**: 修复颜色选择器前景色更新和调色板同步问题

- **🐛 关键错误修复**
  - **HTML 枚举处理**: 修复自增枚举值在 HTML 上下文中变成字符串的问题
  - **渐变样式管理**: 改进 CSS 注入，使用基于令牌的行扫描替代正则表达式

- **🛠️ 架构改进**
  - **构建系统增强**: 使用 Rollup replace 插件实现 `__IS_DEV__` 宏用于开发/生产构建
  - **渐变系统重构**: 通过主入口集中渐变功能，而非直接导出 hacker 模块
  - **纯函数**: 引入 `purge()` 纯函数用于 CSS 令牌行删除
  - **错误处理**: 为加密/解密操作提供全面的错误处理

- **🧹 代码质量与维护**
  - **模板编译器**: 120+ 个模板变量，采用系统化命名约定
  - **文档**: 增强整个代码库的 JSDoc 注释和代码文档
  - **测试环境**: 通过适当的环境检测改进开发测试

### 1.3.0

- **🎯 界面/体验重大改进**
  - **调色盘**：增加了调色盘功能
    - 现在可以在控制面板中配置浅色和深色主题的调色盘
    - 提供了默认的浅色和深色调色板
  - **自定义滚动条文本框**：因为 VS Code 不支持自定义滚动条样式所以我手写了一个！
    - 带有朴素美观滚动条的文本框组件，用来编辑`项目指示器`配置
    - 滚动条大小能反映内容比例 - 内容少时滚动条大，内容多时滚动条小
    - 增强了鼠标滚轮和拖拽交互，提供更好的用户控制
  - **视觉反馈**：改进了带有动画 SVG 的加载状态
  - **主题一致性**：增强了主题切换的视觉连续性
  - **响应式设计**：更好地适应不同屏幕尺寸的布局

- **🛠️ 代码质量提升**
  - **TypeScript 集成**：在整个代码库中添加了全面的 JSDoc 类型注解
  - **HTMLElement 扩展**：为自定义 HTMLElement 原型扩展（mount 方法）添加了正确的类型
  - **模块化架构**：重新组织代码结构，更好地分离关注点
  - **错误处理**：改进了错误处理，提供更好的用户反馈

- **🚀 性能优化**
  - **内存管理**：优化了 DOM 操作和事件处理
  - **高效渲染**：减少了控制面板中的不必要重新渲染
  - **更好的资源使用**：改进了事件监听器和 DOM 引用的清理

- **🧪 开发者体验**
  - **更好的调试**：增强了日志记录和错误报告
  - **代码文档**：全面的函数和方法文档
  - **可维护代码**：更清洁的代码结构和更好的命名规范

### 1.2.2

- **🔧 错误修复**
  - 文本区域高度自动调整
  - 修复了每次都以为自己是新版本的问题
  - 修复了升级提示变成了函数内容的问题

- **🎨 新增随机颜色功能**
  - 调色盘随机：从配置的颜色调色板中随机选择颜色
  - 纯随机颜色：生成完全随机的 RGB 颜色
  - 手动颜色选择器：通过可视化选择器指定自定义颜色

- **🎯 界面/体验优化**:
  - 重新设计颜色选择器，采用调色盘表情符号按钮样式
  - 加宽控制面板以获得更好的布局

### 1.2.1

- **🔧 错误修复**: 修复了控制面板对配置更改不响应的问题
- **#️⃣ 性能优化**: 增加了专门的版本管理和版本更新事件检测器
- **🛡️ 安全保护**: 防止打开多个控制面板实例的保险模式
- **🎨 界面改进**: 增强控制面板样式，添加彩色标题特效
- **📝 体验优化**: 改进了 CSS 路径配置的文本区域自动调整大小
- **🔄 配置管理**: 修复了全局配置更新后不会自动刷新的问题
- **📊 反馈改进**: 重新计算颜色时会显示变成了什么颜色

### 1.2.0

- **🔥 重大变更**: 用统一控制面板替换所有命令
- **新控制面板**: 直观的基于网页的所有设置界面
- **增强颜色选择器**: 带实时预览的手动颜色选择
- **改进用户体验**: 更好的错误处理和成功反馈
- 修复了无论是否阻止 pop 信息都会导致渐变启用的问题

### 1.1.0

- 新增了渐变亮度、渐变暗度等配置
- 多哈希源选择 - 支持项目名、完整路径、项目名+日期等
- 代码结构调整、尝试了若干错误处理方案但最终选择了精简

### 1.0.0

- 美丽的渐变叠加效果。灵感来自 Idea

### 0.0.1

- 初始发布
- 基于项目的颜色生成
- 多语言支持
- 可自定义调色板
- 智能项目检测
