<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${Panel.title}</title>
  <style>
    :root {
      --ct-primary: #226de7;
      --ct-primary-light: #5595fc;
      --ct-success: #1fc34b;
      --ct-danger: #de2919;
      --ct-warning: #efb300;
      --ct-purple: #6c08d1;
      --ct-text-color: #202124;
      --ct-text-color-weak: rgba(32, 33, 36, 0.7);
      --ct-bg-color: #f8f9fa;
      --ct-panel-bg: #ffffff;
      --ct-border-color: rgba(224, 224, 224, 0.5);
      --ct-shadow-color: rgba(0, 0, 0, 0.1);
      --ct-shadow-light-color: rgba(0, 0, 0, 0.1);
      --ct-loading-bg-color: rgba(71, 73, 78, 0.12);
      --ct-focus-shadow: rgba(66, 133, 244, 0.2);
    }

    [theme="dark"] {
      --ct-primary: #3980f3;
      --ct-primary-light: #69a2ff;
      --ct-success: #15b941;
      --ct-danger: #e53020;
      --ct-warning: #fbbc05;
      --ct-purple: #792bc7;
      --ct-text-color: #e8eaed;
      --ct-text-color-weak: rgba(232, 234, 237, 0.7);
      --ct-bg-color: #202124;
      --ct-panel-bg: #292a2d;
      --ct-border-color: rgba(60, 64, 67, 0.5);
      --ct-shadow-color: rgba(0, 0, 0, 0.3);
      --ct-shadow-light-color: rgba(34, 34, 34, 0.5);
      --ct-loading-bg-color: rgba(241, 241, 241, 0.12);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-size: 14px;
    }

    .body {
      font-family: 'Roboto', sans-serif;
      background-color: transparent;
      color: var(--ct-text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }

    .control-panel {
      position: relative;
      padding: 30px;
      width: 100%;
      max-width: 540px;
      background-color: var(--ct-panel-bg);
      border-radius: 16px;
      box-shadow: 0 10px 30px var(--ct-shadow-color);
      transition: background-color 0.3s;
      border: 1px solid var(--ct-border-color);
    }

    .control-panel::after {
      content: "${Panel.loading}";
      font-size: 60px;
      text-align: center;
      line-height: 382px;
      color: rgb(237, 237, 237);
      text-shadow: 1px 3px 6px rgb(107, 107, 107);

      position: absolute;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      border-radius: 16px;
      pointer-events: none;
      background-color: var(--ct-loading-bg-color);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .freeze::after {
      opacity: 1;
      pointer-events: all;
    }

    .header {
      margin-bottom: 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      color: var(--ct-text-color);
      font-weight: 500;
      font-size: 20px;
      text-shadow: 1px 1px 2px var(--ct-shadow-light-color);
    }

    .header .colorful-title {
      font-weight: bold;
      font-size: 20px;
      background: linear-gradient(91deg, var(--ct-danger), var(--ct-warning), var(--ct-success), var(--ct-primary), var(--ct-purple));
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
      text-shadow: 1px 1px 6px rgba(209, 209, 209, 0.5);
      font-family: 'Segoe UI', sans-serif;
      margin: 0.2em 0.4em 0.7em 0;
    }

    .header p {
      color: var(--ct-text-color-weak);
      margin: 5px 0px 0px 0px;
    }

    .header a {
      margin-left: 5px;
      color: var(--ct-primary);
      text-decoration: none;
    }

    .header a:hover {
      text-decoration: underline;
    }

    .header .version {
      font-size: 0.7em;
      color: var(--ct-text-color-weak);
    }


    .control-item {
      display: grid;
      grid-template-columns: 1fr auto;
      grid-template-rows: auto auto auto;
      column-gap: 20px;
      margin-bottom: 10px;
      padding-bottom: 10px;
      align-items: center;
      border-bottom: 1px solid var(--ct-border-color);
    }

    .control-label-group {
      display: grid;
      grid-template-rows: auto auto;
      color: var(--ct-text-color);
    }

    .control-desc {
      font-size: 0.8em;
      color: var(--ct-text-color-weak);
    }

    .control-error {
      grid-column: 1 / span 2;
      font-size: 0.8em;
      color: var(--ct-danger);
    }

    .control-succ {
      grid-column: 1 / span 2;
      font-size: 0.8em;
      color: var(--ct-success);
    }

    .control-input-group {
      display: flex;
      align-items: center;
      font-family: Arial, Helvetica, sans-serif;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: var(--ct-primary);
    }

    input:checked+.slider:before {
      transform: translateX(20px);
    }

    [theme="dark"] .slider {
      background-color: #555;
    }

    [theme="dark"] .slider:before {
      background-color: #f1f1f1;
    }

    [theme="dark"] input:checked+.slider {
      background-color: var(--ct-primary);
    }

    .control-button {
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--ct-primary);
      color: white;
    }

    .control-button:hover {
      opacity: 0.9;
    }

    .picker input[type=color] {
      width: 0;
      height: 0;
      opacity: 0;
      border: 0;
    }

    .picker {
      position: relative;
      border-radius: 50%;
      color: transparent;
      box-shadow: inset 0 0 0 2px #dfdfdf;
    }

    .picker::before {
      position: absolute;
      content: 'üé®';
      color: white;
      left: 52%;
      top: 47%;
      transform: translate(-50%, -50%);
      font-size: 1.2em;
    }

    .select {
      min-width: 120px;
    }


    .textarea,
    .select,
    .input-percent input[type="number"] {
      border: 1px solid var(--ct-border-color);
      border-radius: 8px;
      padding: 8px 30px 8px 12px;
      background-color: var(--ct-panel-bg);
      color: var(--ct-text-color);
    }

    .textarea {
      padding: 8px 12px 8px 12px;
      font-family: 'Roboto', sans-serif;
      resize: none;
      overflow: hidden;
    }

    .input-percent input[type="number"] {
      position: relative;
      width: 75px;
      text-align: right;
    }

    .input-percent input[type="number"]::-webkit-inner-spin-button,
    .input-percent input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .input-percent::after {
      position: absolute;
      content: '%';
      right: 40px;
      margin-top: -2px;
      color: var(--ct-text-color-weak);
    }

    .select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 8px center;
      background-repeat: no-repeat;
      background-size: 16px;
      padding-right: 26px;
      cursor: pointer;
    }

    textarea,
    button,
    input,
    select {
      transition: all 0.3s ease;
    }

    .textarea:hover,
    .select:hover,
    .input-percent input[type="number"]:focus {
      border-color: var(--ct-primary);
      box-shadow: 0 0 0 1px var(--ct-primary);
    }

    .textarea:focus,
    .select:focus,
    .input-percent input[type="number"]:focus {
      outline: none;
      border-color: var(--ct-primary);
      box-shadow: 0 0 0 2px var(--ct-focus-shadow);
    }

    .btn:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--ct-focus-shadow);
    }

    .toggle-switch input:focus+.slider {
      box-shadow: 0 0 0 2px var(--ct-focus-shadow);
    }

    [theme="dark"] .select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23abadb4' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    }

    /* ‰∏ãÊãâËèúÂçïÊ†∑Âºè */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-button {
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--ct-primary);
      color: white;
      min-width: 120px;
      position: relative;
    }

    .dropdown-button::after {
      content: '';
      margin-left: 8px;
      border: solid white;
      border-width: 0 2px 2px 0;
      display: inline-block;
      padding: 3px;
      transform: rotate(45deg);
      transition: transform 0.3s ease;
    }

    .dropdown:hover .dropdown-button::after,
    .dropdown:focus-within .dropdown-button::after {
      transform: rotate(-135deg);
    }

    .dropdown-button:hover {
      opacity: 0.9;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: var(--ct-panel-bg);
      border: 1px solid var(--ct-border-color);
      border-radius: 8px;
      box-shadow: 0 4px 12px var(--ct-shadow-color);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1000;
      overflow: hidden;
      margin-top: 4px;
    }

    .dropdown:hover .dropdown-menu,
    .dropdown:focus-within .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: block;
      width: 100%;
      padding: 12px 16px;
      border: none;
      background: none;
      color: var(--ct-text-color);
      text-align: left;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
      border-bottom: 1px solid var(--ct-border-color);
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    /* .dropdown-item:focus  */
    .dropdown-item:hover {
      background-color: var(--ct-primary);
      color: white;
      outline: none;
    }

    .dropdown-item:active {
      opacity: 0.9;
    }

    /* Èò≤Ê≠¢‰∏ãÊãâËèúÂçïÂú®ÊÇ¨ÂÅúÊó∂Èó™ÁÉÅ */
    .dropdown:hover,
    .dropdown:focus-within {
      z-index: 11;
    }

    .color-picker {
      position: relative;
      padding-left: 40px;
    }

    .color-picker::before {
      content: 'üé®';
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2em;
    }

    .color-picker input[type="color"] {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
  </style>
  <style category="theme-switch">
    .kskb-theme-switch {
      --kskb-border: 1px;
      --kskb-base: 20px;
      --kskb-emoji-size: 20px;
      --kskb-pad: 2px;
      --kskb-width: calc(var(--kskb-base) * 4);
      --kskb-height: calc(var(--kskb-base) * 2);
      --kskb-emoji-diameter: calc(var(--kskb-base) * 2 - var(--kskb-pad) * 2 - var(--kskb-border) * 2);
      --kskb-sun-x: calc(var(--kskb-width) - var(--kskb-emoji-diameter) - var(--kskb-pad) - var(--kskb-border));
      --kskb-moon-x: calc(var(--kskb-pad) + var(--kskb-border));
      --kskb-func: cubic-bezier(0.23, 1, 0.32, 1);
    }

    .kskb-theme-switch {
      position: relative;
      display: inline-block;
      width: var(--kskb-width);
      height: var(--kskb-height);
      border-width: var(--kskb-border);
      border-style: solid;
      border-radius: calc(var(--kskb-base) + var(--kskb-border));
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: all 0.8s var(--kskb-func);

      background-color: #3F3F3F;
      border-color: #8e8e8e;
    }

    .kskb-theme-switch::before,
    .kskb-theme-switch::after {
      position: absolute;
      content: '';
      border-radius: calc(var(--kskb-base) + var(--kskb-border));
      transition: all 0.5s;
      pointer-events: none;
      opacity: 0;
    }

    .kskb-theme-switch::before {
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }

    .kskb-theme-switch::after {
      width: 300%;
      height: 600%;
      top: -250%;
      left: -75%;
    }

    .kskb-theme-switch::before {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.36) 0%, transparent 50%);
      z-index: 10;
    }

    .kskb-theme-switch:has(.kskb-dummy:not(:checked)):hover::before {
      opacity: 1;
    }

    /* Â§™Èò≥Â∞ÑÁ∫ø */
    .kskb-theme-switch::after {
      background:
        repeating-conic-gradient(rgba(255, 255, 251, 0.26) 0deg 18deg,
          transparent 18deg 40deg);
      animation: kskbSunRays 12s infinite linear, kskbSunGlow 3s infinite alternate ease-in-out;
    }

    @keyframes kskbSunRays {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes kskbSunGlow {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    .kskb-theme-switch:has(.kskb-dummy:checked):hover::after {
      animation-play-state: running;
    }

    .kskb-theme-switch:has(.kskb-dummy:not(:checked))::after {
      animation-play-state: paused;
      display: none;
    }

    .kskb-dummy {
      width: 0;
      height: 0;
      border: 0;
    }

    .kskb-moon,
    .kskb-sun {
      position: absolute;
      top: calc(var(--kskb-pad) + var(--kskb-border));
      width: var(--kskb-emoji-diameter);
      height: var(--kskb-emoji-diameter);
      border-radius: var(--kskb-base);
      transition: all 0.5s var(--kskb-func);
      z-index: 5;
    }

    .kskb-icon::before {
      position: absolute;
      width: 100%;
      height: 100%;
      text-align: center;
    }

    .kskb-sun .kskb-icon::before {
      content: '‚òÄÔ∏è';
      font-size: var(--kskb-emoji-size);
    }

    .kskb-moon .kskb-icon::before {
      content: 'üåô';
      font-size: var(--kskb-emoji-size);
    }

    .kskb-moon {
      left: var(--kskb-moon-x);
      background: linear-gradient(145deg, #5a5a5a, #424242);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .kskb-sun {
      left: var(--kskb-sun-x);
      background: linear-gradient(145deg, #fffac1, #ffd06c);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }


    /* ÂΩì checkbox Ë¢´ÈÄâ‰∏≠Êó∂ÁöÑÊ†∑Âºè */
    .kskb-dummy:not(:checked)~.kskb-moon {
      left: var(--kskb-moon-x);
      opacity: 1;
    }

    .kskb-dummy:checked~.kskb-moon {
      left: var(--kskb-sun-x);
      opacity: 0;
    }

    .kskb-dummy:not(:checked)~.kskb-sun {
      left: var(--kskb-moon-x);
      opacity: 0;
    }

    .kskb-dummy:checked~.kskb-sun {
      left: var(--kskb-sun-x);
      opacity: 1;
    }

    .kskb-theme-switch:has(.kskb-dummy:checked) {
      background-color: #b8f0ff;
      border-color: #fbfbfb;
    }
  </style>

  <style category="stars">
    /* Ê∑ªÂä†ÊòüÊòüË£ÖÈ•∞Ôºà‰ªÖÂú®ÊöóËâ≤Ê®°Âºè‰∏ãÂèØËßÅÔºâ */
    .kskb-stars {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0;
      transition: opacity 0.5s var(--kskb-func);
      z-index: 10;
    }

    .kskb-dummy:not(:checked)~.kskb-stars {
      opacity: 0.45;
    }

    .kskb-star {
      position: absolute;
      background-color: white;
      border-radius: 50%;
      animation: kskbTwinkle 2.4s infinite alternate;
      transition: left 0.6s var(--kskb-func);
    }

    @keyframes kskbTwinkle {
      0% {
        opacity: 0.2;
      }

      100% {
        opacity: 1;
      }
    }

    /* ÂàõÂª∫‰∏Ä‰∫õÈöèÊú∫ÊòüÊòü */
    .kskb-star:nth-child(1) {
      width: 2px;
      height: 2px;
      top: 8%;
      left: 48%;
      animation-delay: 0.2s;
    }

    .kskb-dummy:checked~.kskb-stars .kskb-star:nth-child(1) {
      left: 148%;
    }

    .kskb-star:nth-child(2) {
      width: 3px;
      height: 3px;
      top: 20%;
      left: 16%;
      animation-delay: 0.5s;
    }

    .kskb-dummy:checked~.kskb-stars .kskb-star:nth-child(2) {
      left: 116%;
    }

    .kskb-star:nth-child(3) {
      width: 2px;
      height: 2px;
      top: 72%;
      left: 51%;
      animation-delay: 0.8s;
    }

    .kskb-dummy:checked~.kskb-stars .kskb-star:nth-child(3) {
      left: 151%;
    }

    .kskb-star:nth-child(4) {
      width: 3px;
      height: 3px;
      top: 20%;
      left: 80%;
      animation-delay: 1.1s;
    }

    .kskb-dummy:checked~.kskb-stars .kskb-star:nth-child(4) {
      left: 180%;
    }

    .kskb-star:nth-child(5) {
      width: 2px;
      height: 2px;
      top: 52%;
      left: 72%;
      animation-delay: 1.4s;
    }

    .kskb-dummy:checked~.kskb-stars .kskb-star:nth-child(5) {
      left: 172%;
    }
  </style>

  <style category="clouds">
    /* Ê∑ªÂä†‰∫ëÊúµË£ÖÈ•∞Ôºà‰ªÖÂú®Êòé‰∫ÆÊ®°Âºè‰∏ãÂèØËßÅÔºâ */
    .kskb-clouds {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0;
      transition: opacity 0.5s var(--kskb-func);
    }

    .kskb-dummy:checked~.kskb-clouds {
      opacity: 0.6;
    }

    .kskb-cloud {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 20px;
      animation: float 4s infinite ease-in-out;
      transition: left 0.8s var(--kskb-func);
      scale: 3.5;
    }

    .kskb-cloud::before,
    .kskb-cloud::after {
      content: '';
      position: absolute;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 20px;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-2px);
      }
    }

    /* ÂàõÂª∫‰∏çÂêåÂ§ßÂ∞èÁöÑ‰∫ëÊúµ */
    .kskb-cloud:nth-child(1) {
      width: 8px;
      height: 4px;
      top: 5%;
      left: -120%;
      animation-delay: 0.3s;
    }

    .kskb-cloud:nth-child(1)::before {
      width: 6px;
      height: 6px;
      top: -3px;
      left: 2px;
    }

    .kskb-cloud:nth-child(1)::after {
      width: 4px;
      height: 4px;
      top: -2px;
      right: 1px;
    }

    .kskb-dummy:checked~.kskb-clouds .kskb-cloud:nth-child(1) {
      left: 26%;
    }

    .kskb-cloud:nth-child(2) {
      width: 10px;
      height: 5px;
      top: 92%;
      left: -25%;
      animation-delay: 0.8s;
    }

    .kskb-cloud:nth-child(2)::before {
      width: 7px;
      height: 7px;
      top: -4px;
      left: 3px;
    }

    .kskb-cloud:nth-child(2)::after {
      width: 5px;
      height: 5px;
      top: -3px;
      right: 2px;
    }

    .kskb-dummy:checked~.kskb-clouds .kskb-cloud:nth-child(2) {
      left: 75%;
    }

    .kskb-cloud:nth-child(3) {
      width: 6px;
      height: 3px;
      top: 92%;
      left: -110%;
      animation-delay: 1.2s;
    }

    .kskb-cloud:nth-child(3)::before {
      width: 4px;
      height: 4px;
      top: -2px;
      left: 2px;
    }

    .kskb-cloud:nth-child(3)::after {
      width: 3px;
      height: 3px;
      top: -1px;
      right: 1px;
    }

    .kskb-dummy:checked~.kskb-clouds .kskb-cloud:nth-child(3) {
      left: 24%;
    }
  </style>
</head>

<body>
  <div class="body" theme="${configs.theme}">
    <form id="settings" class="control-panel">
      <div class="header">
        <div>
          <h1><span class="colorful-title">${Consts.DisplayName}</span><span class="version">v${version.get(this)}</span></h1>
          <p>by<a href="https://github.com/baendlorel">Kasukabe Tsumugi</a></p>
          <p>${Panel.description}</p>
        </div>
        <div>
          <label for="theme" class="kskb-theme-switch">
            <input type="checkbox" id="theme" name="theme" class="control-input kskb-dummy">
            <div class="kskb-moon">
              <div class="kskb-icon"></div>
            </div>
            <div class="kskb-sun">
              <div class="kskb-icon"></div>
            </div>
            <div class="kskb-stars">
              <div class="kskb-star"></div>
              <div class="kskb-star"></div>
              <div class="kskb-star"></div>
              <div class="kskb-star"></div>
              <div class="kskb-star"></div>
            </div>
            <div class="kskb-clouds">
              <div class="kskb-cloud"></div>
              <div class="kskb-cloud"></div>
              <div class="kskb-cloud"></div>
            </div>
          </label>
        </div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <div class="control-label">${Panel.showSuggest.label}</div>
          <div class="control-desc">${Panel.showSuggest.description}</div>
        </div>
        <div class="control-input-group">
          <label class="toggle-switch">
            <input type="checkbox" class="control-input" name="showSuggest">
            <span class="slider"></span>
          </label>
        </div>
        <div class="control-error" name="showSuggest"></div>
        <div class="control-succ" name="showSuggest"></div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <div class="control-label">${Panel.workbenchCssPath.label}</div>
          <div class="control-desc">${Panel.workbenchCssPath.description}</div>
        </div>
        <div class="control-input-group">
          <textarea class="control-input textarea" name="workbenchCssPath"></textarea>
        </div>
        <div class="control-error" name="workbenchCssPath"></div>
        <div class="control-succ" name="workbenchCssPath"></div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <label class="control-label">${Panel.gradient.label}</label>
          <div class="control-desc">${Panel.gradient.description}</div>
        </div>
        <div class="control-input-group">
          <select name="gradient" class="control-input select">
            <option value="" selected>${Panel.gradient.empty}</option>
            <option value="${GradientStyle.BrightCenter}">
              ${Panel.gradient[GradientStyle.BrightCenter]}
            </option>
            <option value="${GradientStyle.BrightLeft}">
              ${Panel.gradient[GradientStyle.BrightLeft]}
            </option>
            <option value="${GradientStyle.ArcLeft}">${Panel.gradient[GradientStyle.ArcLeft]}</option>
          </select>
        </div>
        <div class="control-error" name="gradient"></div>
        <div class="control-succ" name="gradient"></div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <div class="control-label">${Panel.gradientBrightness.label}</div>
          <div class="control-desc">${Panel.gradientBrightness.description}</div>
        </div>
        <div class="control-input-group input-percent">
          <input type="number" min="0" max="100" step="5" class="control-input" name="gradientBrightness" />
        </div>
        <div class="control-error" name="gradientBrightness"></div>
        <div class="control-succ" name="gradientBrightness"></div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <div class="control-label">${Panel.gradientDarkness.label}</div>
          <div class="control-desc">${Panel.gradientDarkness.description}</div>
        </div>
        <div class="control-input-group input-percent">
          <input type="number" min="0" max="100" step="5" class="control-input" name="gradientDarkness" />
        </div>
        <div class="control-error" name="gradientDarkness"></div>
        <div class="control-succ" name="gradientDarkness"></div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <div class="control-label">${Panel.hashSource.label}</div>
          <div class="control-desc">${Panel.hashSource.description}</div>
        </div>
        <div class="control-input-group">
          <select name="hashSource" class="control-input select">
            <option value="${HashSource.ProjectName}">
              ${Panel.hashSource[HashSource.ProjectName]}
            </option>
            <option value="${HashSource.FullPath}">${Panel.hashSource[HashSource.FullPath]}</option>
            <option value="${HashSource.ProjectNameDate}">
              ${Panel.hashSource[HashSource.ProjectNameDate]}
            </option>
          </select>
        </div>
        <div class="control-error" name="hashSource"></div>
        <div class="control-succ" name="hashSource"></div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <div class="control-label">${Panel.randomColor.label}</div>
          <div class="control-desc">${Panel.randomColor.description}</div>
        </div>
        <div class="control-input-group">
          <div class="dropdown">
            <button type="button" class="dropdown-button" tabindex="0">
              ${Panel.randomColor.label}
            </button>
            <div class="dropdown-menu">
              <button type="button" class="dropdown-item" name="randomColor.colorSet">
                ${Panel.randomColor.colorSet}
              </button>
              <button type="button" class="dropdown-item" name="randomColor.pure">
                ${Panel.randomColor.pure}
              </button>
              <button type="button" class="dropdown-item color-picker" title="${Panel.randomColor.specify}" name="randomColor.specify">
                ${Panel.randomColor.specify}
                <input type="color" class="control-input" name="randomColor.specify">
              </button>
            </div>
          </div>
        </div>
        <div class="control-error" name="randomColor"></div>
        <div class="control-succ" name="randomColor"></div>
      </div>

      <div class="control-item">
        <div class="control-label-group">
          <div class="control-label">${Panel.refresh.label}</div>
          <div class="control-desc">${Panel.refresh.description}</div>
        </div>
        <div class="control-input-group">
          <button type="button" class="control-button" name="refresh">
            <span>${Panel.refresh.button}</span>
          </button>
        </div>
        <div class="control-error" name="refresh"></div>
        <div class="control-succ" name="refresh"></div>
      </div>
    </form>
  </div>

  <script>
    {
      const isProd = '${env}' === 'prod';

      // functions
      const vspost = (() => {
        let o = isProd ? acquireVsCodeApi() : {
          postMessage: (a) => console.log('vscode.postMessage', a)
        };
        return function (data) {
          freeze();
          o.postMessage({
            from: 'colorful-titlebar',
            ...data
          });
        }
      })();

      const theme = () => {
        const body = document.querySelector('.body');
        const currentTheme = body.getAttribute('theme');
        body.setAttribute('theme', currentTheme === 'dark' ? 'light' : 'dark');
      }

      /**
       * ÈªòËÆ§Êü•ÊâæÁöÑÊòØËæìÂÖ•ÂÖÉÁ¥†ÔºåÂèØ‰ª•ÊåáÂÆöÊü•ÊâæÁ±ªÂûã
       * @param {string} name - ÂÖÉÁ¥†ÁöÑ name Â±ûÊÄß
       * @param {string} tp - ÂÖÉÁ¥†Á±ªÂûãÔºöinput | button | error | succ
       */
      const find = (name, tp = 'input') => {
        switch (tp) {
          case 'succ':
            return document.querySelector(['.control-succ[name="', name, '"]'].join(''));
          case 'error':
            return document.querySelector(['.control-error[name="', name, '"]'].join(''));
          case 'button':
            return document.querySelector(['button[name="', name, '"]', ',.control-button[name="', name, '"]'].join(''));
          case 'input':
          default:
            return document.querySelector(['.control-input[name="', name, '"]'].join(''))
        }
      };

      const i18n = (() => {
        const zh = {
          NumberLimit: (min, max, isInt = true) => ['ËØ∑ËæìÂÖ•', min, 'Âà∞', max, '‰πãÈó¥ÁöÑ', isInt ? 'Êï¥Êï∞' : 'Êï∞'].join('')
        }
        const en = {
          NumberLimit: (min, max, isInt = true) => ['Please input', isInt ? 'an integer' : 'a number', 'between', min, 'and', max].join(' ')
        }
        switch ('${configs.lang}') {
          case 'zh':
            return zh;
          case 'en':
            return en;
          default:
            return zh;
        }
      })()

      /**
       * @type {HTMLFormElement} 
       */
      const settings = document.getElementById('settings');
      const formInputs = Array.from(settings.elements);

      const freeze = () => {
        document.querySelectorAll('.control-error,.control-succ').forEach(el => el.textContent = '');
        if (isProd) {
          settings.classList.add('freeze');
          formInputs.forEach((el) => el.disabled = true);
        }
      }

      const unfreeze = () => {
        setTimeout(() => settings.classList.remove('freeze'), 200);
        formInputs.forEach((el) => el.disabled = false)
      }

      // init
      if (isProd) {
        find('theme').checked = "${configs.theme}" === 'light';
        find('showSuggest').checked = '${configs.showSuggest}' === 'true';
        find('workbenchCssPath').value = '${configs.workbenchCssPath}';
        find('hashSource').value = '${configs.hashSource}';
        find('gradientBrightness').value = '${gradientBrightness}';
        find('gradientDarkness').value = '${gradientDarkness}';
        find('randomColor.specify', 'button').style.backgroundColor = '${currentColor}';
        find('randomColor.specify').value = '${currentColor}';
      } else {
        const testScript = document.createElement('script');
        testScript.src = './template-replacer.js';
        document.body.appendChild(testScript);
        find('theme').checked = true;
        find('showSuggest').checked = false;
        find('workbenchCssPath').value = '/d/work/ddddddddddd/fffffffff/44444444/222222222/44444444/aaa.css';
        find('hashSource').value = '';
        find('gradientBrightness').value = '99';
        find('gradientDarkness').value = '12';
        find('randomColor.specify', 'button').style.backgroundColor = '#007ACC';
        find('randomColor.specify').value = '#007ACC';
      }

      // ÂàùÂßãÂåñ‰∏ªÈ¢òÂàáÊç¢Âô®
      find('theme').addEventListener('change', theme);

      // ÂàùÂßãÂåñÊâÄÊúâtextarea
      Array.from(document.querySelectorAll('textarea')).forEach((textarea) => {
        textarea.addEventListener('input', (event) => {
          textarea.style.height = 'auto';
          textarea.style.height = textarea.scrollHeight + 'px';
        });
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
      });


      // ÂàùÂßãÂåñÊâÄÊúâÈ¢úËâ≤ÈÄâÊã©Âô®
      Array.from(document.querySelectorAll('button.color-picker')).forEach((picker) => {
        const colorInput = picker.querySelector('input[type="color"]');
        colorInput.addEventListener('input', () => picker.style.backgroundColor = colorInput.value);
        picker.addEventListener('click', colorInput.click.bind(colorInput));
      });

      // Ë¶ÅÊé®ÈÄÅÂà∞Êèí‰ª∂ÁöÑ‰∫ã‰ª∂
      ['randomColor.colorSet', 'randomColor.pure', 'refresh'].forEach((name) => {
        const button = find(name, 'button');
        if (button) {
          button.onclick = () => vspost({ name, value: find(name)?.value });
        }
      });

      settings.addEventListener('change', function (event) {
        event.preventDefault();
        const input = event.target;
        // ÊéßÂà∂Èù¢ÊùøÁöÑ‰∏ªÈ¢òÂèòÊõ¥‰∏çÈúÄË¶ÅÊé®ÈÄÅÁªôÊèí‰ª∂
        if (input.name === 'theme') {
          return;
        }

        const data = {
          name: input.name,
          value: input.value
        };

        // Â¶ÇÊûúÊï∞Â≠óÁ±ª‰∏çÁ¨¶ÂêàË¶ÅÊ±ÇÔºåÂàôËøîÂõûÂπ∂ÊèêÁ§∫
        if (input.type === 'number') {
          const value = parseInt(input.value, 10);
          let max = parseInt(input.max, 10);
          let min = parseInt(input.min, 10);
          max = Number.isNaN(max) ? Infinity : max;
          min = Number.isNaN(min) ? Infinity : min;

          if (Number.isNaN(value) || value < min || value > max) {
            find(input.name, 'error').innerText = i18n.NumberLimit(min, max, true);
            input.value = input.defaultValue; // ÊÅ¢Â§çÈªòËÆ§ÂÄº
            return;
          }
          data.value = value;
        } else if (input.type === 'checkbox') {
          data.value = input.checked;
        }

        vspost(data);
      });

      // Êèí‰ª∂ÂõûÈ¶àÁöÑÁªìÊûú
      window.addEventListener('message', (event) => {
        const resp = event.data;
        if (resp.from !== 'colorful-titlebar') {
          return;
        }
        unfreeze();

        if (!resp.succ) {
          find(resp.name, 'error').textContent = resp.msg;
          return;
        }

        if (resp.msg) {
          find(resp.name, 'succ').textContent = resp.msg;

          // Â¶ÇÊûúË∞ÉÊï¥‰∫ÜÊ∏êÂèòÈÖçÁΩÆÔºåÈÇ£‰πàÁΩÆÁ©∫Ê∏êÂèòÈÄâÈ°π‰ª•Â§áÈáçÊñ∞ÈÄâÊã©
          if (resp.name === 'gradientBrightness' || resp.name === 'gradientDarkness') {
            find('gradient').value = '';
          }
        }
      });
    } 
  </script>
</body>

</html>